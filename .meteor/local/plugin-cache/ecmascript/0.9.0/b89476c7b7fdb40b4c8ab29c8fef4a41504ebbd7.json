{"metadata":{"usedHelpers":[],"marked":[],"modules":{"imports":[{"source":"./utility.js","imported":[],"specifiers":[]}],"exports":{"exported":["Students"],"specifiers":[{"kind":"local","local":"Students","exported":"Students"}]}}},"options":{"filename":"imports/api/student.js","filenameRelative":"imports/api/student.js","env":{"development":{"plugins":[]}},"retainLines":false,"highlightCode":true,"suppressDeprecationMessages":false,"presets":[],"plugins":[[[],null],[[],null],[[],null],[[],null],[[],null],[[],null],[[],{"generateLetDeclarations":true,"enforceStrictMode":false}],[[],{"polyfill":false}],[[],null],[[],null],[[],null],[[],{"useNativeAsyncAwait":false}],[[],null],[[],null],[[],{"allowTopLevelThis":true,"strict":false,"loose":true}]],"ignore":[],"code":true,"metadata":true,"ast":true,"comments":true,"compact":false,"minified":false,"sourceMap":true,"sourceMaps":true,"sourceMapTarget":"imports/api/student.js.map","sourceFileName":"imports/api/student.js","babelrc":false,"sourceType":"module","moduleIds":false,"passPerPreset":false,"parserOpts":false,"generatorOpts":false,"basename":"student"},"ignored":false,"code":"module.export({\n\tStudents: () => Students\n});\nmodule.watch(require(\"./utility.js\"));\nconst Students = Meteor.users;\n\nif (Meteor.isServer) {\n\tMeteor.publish('Students.findAll', function () {\n\t\tlet filter = {};\n\t\tlet option = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1,\n\t\t\t\tisAdmin: 1\n\t\t\t}\n\t\t};\n\t\treturn Students.find(filter, option);\n\t});\n\tMeteor.publish('Students.findOne', function (id) {\n\t\tlet filter = {\n\t\t\t_id: id\n\t\t};\n\t\tlet option = {\n\t\t\tfields: {\n\t\t\t\t_id: 1,\n\t\t\t\tusername: 1,\n\t\t\t\tfullname: 1,\n\t\t\t\temails: 1,\n\t\t\t\tyear: 1,\n\t\t\t\tisAdmin: 1\n\t\t\t}\n\t\t};\n\t\treturn Students.find(filter, option);\n\t});\n}\n\nMeteor.methods({\n\t'Students.insert'() {\n\t\tif (!Meteor.isAdmin()) return;\n\t\tAccounts.createUser({\n\t\t\tusername: 'Sample Username',\n\t\t\tfullname: 'Sample Fullname',\n\t\t\tpassword: Random.id(),\n\t\t\temail: 'dsca@inrg.csie.ntu.edu.tw',\n\t\t\tyear: new Date().getFullYear(),\n\t\t\tisAdmin: false\n\t\t});\n\t},\n\n\t'Students.remove'(filter) {\n\t\tif (!Meteor.isAdmin()) return;\n\t\tStudents.find(filter).forEach(student => {\n\t\t\tMeteor.call('Submissions.remove', {\n\t\t\t\tstudentId: student._id\n\t\t\t});\n\t\t});\n\t\tStudents.remove(filter);\n\t},\n\n\t'Students.update'(id, option) {\n\t\tif (!Meteor.isAdmin() || Meteor.isClient) return;\n\n\t\tif (option.username) {\n\t\t\tAccounts.setUsername(id, option.username);\n\t\t\tdelete option.username;\n\t\t}\n\n\t\tif (option.password) {\n\t\t\tAccounts.setPassword(id, option.password);\n\t\t\tdelete option.password;\n\t\t}\n\n\t\tif (option.email) {\n\t\t\tStudents.update({\n\t\t\t\t_id: id\n\t\t\t}, {\n\t\t\t\t$set: {\n\t\t\t\t\temails: []\n\t\t\t\t}\n\t\t\t});\n\t\t\tAccounts.addEmail(id, option.email);\n\t\t\tdelete option.email;\n\t\t}\n\n\t\tif (!_.isEmpty(option)) {\n\t\t\tStudents.update({\n\t\t\t\t_id: id\n\t\t\t}, {\n\t\t\t\t$set: option\n\t\t\t});\n\t\t}\n\t},\n\n\t'Students.changePassword'(oldPassword, newPassword) {\n\t\tif (Meteor.isClient) return;\n\t\tAccounts.changePassword(oldPassword, newPassword);\n\t}\n\n});","map":{"version":3,"sources":["imports/api/student.js"],"names":["module","export","Students","watch","require","Meteor","users","isServer","publish","filter","option","fields","_id","username","isAdmin","find","id","fullname","emails","year","methods","Accounts","createUser","password","Random","email","Date","getFullYear","forEach","student","call","studentId","remove","isClient","setUsername","setPassword","update","$set","addEmail","_","isEmpty","oldPassword","newPassword","changePassword"],"mappings":"AAAAA,OAAOC,MAAP,CAAc;AAACC,WAAS,MAAIA;AAAd,CAAd;AAAuCF,OAAOG,KAAP,CAAaC,QAAQ,cAAR,CAAb;AAGhC,MAAMF,WAAWG,OAAOC,KAAxB;;AAEP,IAAID,OAAOE,QAAX,EAAqB;AACpBF,QAAOG,OAAP,CAAe,kBAAf,EAAmC,YAAW;AAC7C,MAAIC,SAAS,EAAb;AACA,MAAIC,SAAS;AAAEC,WAAQ;AAAEC,SAAK,CAAP;AAAUC,cAAU,CAApB;AAAuBC,aAAS;AAAhC;AAAV,GAAb;AAEA,SAAOZ,SAASa,IAAT,CAAcN,MAAd,EAAsBC,MAAtB,CAAP;AACA,EALD;AAMAL,QAAOG,OAAP,CAAe,kBAAf,EAAmC,UAASQ,EAAT,EAAa;AAC/C,MAAIP,SAAS;AAAEG,QAAKI;AAAP,GAAb;AACA,MAAIN,SAAS;AAAEC,WAAQ;AAAEC,SAAK,CAAP;AAAUC,cAAU,CAApB;AAAuBI,cAAU,CAAjC;AAAoCC,YAAQ,CAA5C;AAA+CC,UAAM,CAArD;AAAwDL,aAAS;AAAjE;AAAV,GAAb;AAEA,SAAOZ,SAASa,IAAT,CAAcN,MAAd,EAAsBC,MAAtB,CAAP;AACA,EALD;AAMA;;AAEDL,OAAOe,OAAP,CAAe;AACd,qBAAoB;AACnB,MAAI,CAACf,OAAOS,OAAP,EAAL,EAAuB;AAEvBO,WAASC,UAAT,CAAoB;AACnBT,aAAU,iBADS;AAEnBI,aAAU,iBAFS;AAGnBM,aAAUC,OAAOR,EAAP,EAHS;AAInBS,UAAO,2BAJY;AAKnBN,SAAM,IAAIO,IAAJ,GAAWC,WAAX,EALa;AAMnBb,YAAS;AANU,GAApB;AAQA,EAZa;;AAad,mBAAkBL,MAAlB,EAA0B;AACzB,MAAI,CAACJ,OAAOS,OAAP,EAAL,EAAuB;AAEvBZ,WAASa,IAAT,CAAcN,MAAd,EAAsBmB,OAAtB,CAA+BC,OAAD,IAAa;AAC1CxB,UAAOyB,IAAP,CAAY,oBAAZ,EAAkC;AAAEC,eAAWF,QAAQjB;AAArB,IAAlC;AACA,GAFD;AAGAV,WAAS8B,MAAT,CAAgBvB,MAAhB;AACA,EApBa;;AAqBd,mBAAkBO,EAAlB,EAAsBN,MAAtB,EAA8B;AAC7B,MAAI,CAACL,OAAOS,OAAP,EAAD,IAAqBT,OAAO4B,QAAhC,EAA0C;;AAE1C,MAAIvB,OAAOG,QAAX,EAAqB;AACpBQ,YAASa,WAAT,CAAqBlB,EAArB,EAAyBN,OAAOG,QAAhC;AACA,UAAOH,OAAOG,QAAd;AACA;;AACD,MAAIH,OAAOa,QAAX,EAAqB;AACpBF,YAASc,WAAT,CAAqBnB,EAArB,EAAyBN,OAAOa,QAAhC;AACA,UAAOb,OAAOa,QAAd;AACA;;AACD,MAAIb,OAAOe,KAAX,EAAkB;AACjBvB,YAASkC,MAAT,CAAgB;AAAExB,SAAKI;AAAP,IAAhB,EAA6B;AAAEqB,UAAM;AAAEnB,aAAQ;AAAV;AAAR,IAA7B;AACAG,YAASiB,QAAT,CAAkBtB,EAAlB,EAAsBN,OAAOe,KAA7B;AACA,UAAOf,OAAOe,KAAd;AACA;;AACD,MAAI,CAACc,EAAEC,OAAF,CAAU9B,MAAV,CAAL,EAAwB;AACvBR,YAASkC,MAAT,CAAgB;AAAExB,SAAKI;AAAP,IAAhB,EAA6B;AAAEqB,UAAM3B;AAAR,IAA7B;AACA;AACD,EAxCa;;AAyCd,2BAA0B+B,WAA1B,EAAuCC,WAAvC,EAAoD;AACnD,MAAIrC,OAAO4B,QAAX,EAAqB;AAErBZ,WAASsB,cAAT,CAAwBF,WAAxB,EAAqCC,WAArC;AACA;;AA7Ca,CAAf","file":"imports/api/student.js.map","sourcesContent":["//import { Random } from 'meteor/random';\nimport './utility.js';\n\nexport const Students = Meteor.users;\n\nif (Meteor.isServer) {\n\tMeteor.publish('Students.findAll', function() {\n\t\tlet filter = {};\n\t\tlet option = { fields: { _id: 1, username: 1, isAdmin: 1 }};\n\n\t\treturn Students.find(filter, option);\n\t});\n\tMeteor.publish('Students.findOne', function(id) {\n\t\tlet filter = { _id: id };\n\t\tlet option = { fields: { _id: 1, username: 1, fullname: 1, emails: 1, year: 1, isAdmin: 1 }};\n\n\t\treturn Students.find(filter, option);\n\t});\n}\n\nMeteor.methods({\n\t'Students.insert'() {\n\t\tif (!Meteor.isAdmin()) return;\n\n\t\tAccounts.createUser({\n\t\t\tusername: 'Sample Username',\n\t\t\tfullname: 'Sample Fullname',\n\t\t\tpassword: Random.id(),\n\t\t\temail: 'dsca@inrg.csie.ntu.edu.tw',\t\n\t\t\tyear: new Date().getFullYear(),\n\t\t\tisAdmin: false\n\t\t});\n\t},\n\t'Students.remove'(filter) {\n\t\tif (!Meteor.isAdmin()) return;\n\n\t\tStudents.find(filter).forEach((student) => {\n\t\t\tMeteor.call('Submissions.remove', { studentId: student._id });\n\t\t});\n\t\tStudents.remove(filter);\n\t},\n\t'Students.update'(id, option) {\n\t\tif (!Meteor.isAdmin() || Meteor.isClient) return;\n\n\t\tif (option.username) {\n\t\t\tAccounts.setUsername(id, option.username);\n\t\t\tdelete option.username;\n\t\t}\n\t\tif (option.password) {\n\t\t\tAccounts.setPassword(id, option.password);\n\t\t\tdelete option.password;\n\t\t}\n\t\tif (option.email) {\n\t\t\tStudents.update({ _id: id }, { $set: { emails: [] }});\n\t\t\tAccounts.addEmail(id, option.email);\n\t\t\tdelete option.email;\n\t\t}\n\t\tif (!_.isEmpty(option)) {\n\t\t\tStudents.update({ _id: id }, { $set: option });\n\t\t}\n\t},\n\t'Students.changePassword'(oldPassword, newPassword) {\n\t\tif (Meteor.isClient) return;\n\n\t\tAccounts.changePassword(oldPassword, newPassword);\n\t}\n});"]},"hash":"b89476c7b7fdb40b4c8ab29c8fef4a41504ebbd7"}
